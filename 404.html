<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <!-- <link rel="stylesheet" href="https://samuelg900.github.io/ElsiliasKitchen/404.css"> -->
    <script src="debug.js"></script>
    
    <script> setUpOnlyFor404Debug(); </script>
    
    <!-- vvv Not needed for some reason... I think github automatically calls for any 404.css file in directory -->
    <!-- <link rel="stylesheet" href="404.css"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="icon" type="image/png" href="tab_logo.png" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
<title>My Order</title>

</head>


<body>

    <script>
        function openPayment(type){

            switch(type){
                case "v":
// border: 2px solid blue;
                    document.getElementById("pay_text").innerHTML=`<a style="color: rgb(0, 140, 255);" id="pay_a" href="https://venmo.com/code?user_id=3229643071029248311" target="_blank">VENMO&#8599;</a><br><p id="pay_p">@ElsiliaKitchen</p><br>`;
                    document.getElementById("paymentQr_id").innerHTML='';
                    // document.getElementById("pay_div_id").style.border=`2px solid blue`;

                    new QRCode(document.getElementById("paymentQr_id"), {
                            text: "https://venmo.com/code?user_id=3229643071029248311",
                            width:220,
                            height: 220,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                            });
                            
                    document.getElementById("pay_div_id").classList.toggle("open");
                                    
                    break;
                case "c":

                    document.getElementById("pay_text").innerHTML=`<br><a style="color: #3fc04a" id="pay_a" href="https://cash.app/$Elsamorel1?qr=1" target="_blank">CASH APP&#8599;</a><br><p id="pay_p">$Elsamorel1</p><br>`;
                    document.getElementById("paymentQr_id").innerHTML='';

                    new QRCode(document.getElementById("paymentQr_id"), {
                            text: "https://cash.app/$Elsamorel1?qr=1",
                            width:220,
                            height: 220,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                            });
                            
                    document.getElementById("pay_div_id").classList.toggle("open");

                    break;
                case "x":
                    document.getElementById("pay_div_id").classList.toggle("open");
                    break;
                default:
                    break;
            }

        }
    </script>

    <style>

        .payment_div{
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            align-items: center;
            gap:20px;
            margin-bottom: 10px;
        }

        .payment_div svg{
            cursor: pointer;
            transition: transform 0.6s ease;
        }

        .payment_div svg:hover{
            transform: scale(1.1);
        }

        .svg_v{

            width: 60px;
        }

        .svg_c{
            width: 40px;
        }

      
    </style>

        <div id="pay_div_id">
            <div id="payment_menu_id">
                <span class="backArrow" onclick='openPayment("x")'>&#10006</span>
                <a id="pay_text"></a>
                <div id="paymentQr_id"></div>
            </div>
        </div>

    </div>


    <div class="main_container">
        <div id="qrcode-div-id">
            <h2>Elsilia's Kitchen Order</h2>
            <div class="payment_div">

                <svg onclick='openPayment("v")' xmlns="http://www.w3.org/2000/svg" class="svg_v" viewBox="0 0 512 512">
                <path d="M381.4 105.3c11 18.1 15.9 36.7 15.9 60.3 0 75.1-64.1 172.7-116.2 241.2H162.3l-47.6-285 104.1-9.9 25.3 202.8c23.5-38.4 52.6-98.7 52.6-139.7 0-22.5-3.9-37.8-9.9-50.4z" fill="#008CFF"></path>
            </svg>

            <svg onclick='openPayment("c")' xmlns="http://www.w3.org/2000/svg" class="svg_c" viewBox="0 0 210 210" fill="none">
                <rect width="150" height="150" x="25" y="25" rx="7.81424" fill="#fff"></rect>
                <path fill="#00E013" d="M206.398,30.286c-4.502-12.394-14.307-22.189-26.713-26.687C168.48,0,158.075,0,136.865,0h-63.63c-21.11,0-31.615,0-42.92,3.498C17.909,7.996,8.104,17.792,3.602,30.186C0,41.58,0,52.075,0,73.165v63.57c0,21.19,0,31.585,3.502,42.98c4.502,12.394,14.307,22.189,26.713,26.687C41.62,210,52.125,210,73.135,210h63.63c21.11,0,31.615,0,42.92-3.598c12.406-4.498,22.211-14.293,26.713-26.687C210,168.32,210,157.825,210,136.735v-63.47C210,52.175,210,41.68,206.398,30.286z M151.472,71.866l-12.106,9.895c-1.101,0.9-2.601,0.7-3.402-0.4c-6.203-7.596-15.807-11.894-26.312-11.894c-11.706,0-19.009,5.098-19.009,12.294c-0.2,6.097,5.503,9.196,23.011,12.994c22.111,4.698,32.215,13.893,32.215,29.386c0,19.391-15.808,33.684-40.519,35.283l-2.401,11.495c-0.2,1.099-1.201,1.899-2.401,1.899H81.539c-1.601,0-2.701-1.499-2.401-2.999l3.001-12.794c-12.206-3.498-22.111-10.295-27.813-18.591c-0.7-1.099-0.5-2.499,0.5-3.298l13.206-10.395c1.101-0.9,2.701-0.6,3.502,0.5c7.003,9.795,17.808,15.593,30.815,15.593c11.706,0,20.51-5.697,20.51-13.893c0-6.297-4.402-9.196-19.309-12.294c-25.412-5.497-35.517-14.793-35.517-30.286c0-17.991,15.107-31.485,37.918-33.284l2.501-11.894c0.2-1.099,1.201-1.899,2.401-1.899h18.709c1.501,0,2.701,1.399,2.401,2.899l-2.901,13.294c9.805,2.999,17.808,8.396,22.811,15.093C152.673,69.567,152.473,71.066,151.472,71.866z"></path>
            </svg>
                
                <p id="total_id"></p>
            </div>
            <div id="qrcode"></div>
        </div>

        <div id="cart_contents_id">
            <div class="cartContent">
                <div class="cartItems" id="cartItemsId">
                </div>
            </div>
        </div>
    </div>

<script>
    const allItems = [];
    function getJsonData() {
    fetch('https://samuelg900.github.io/ElsiliasKitchen/items.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            // allItems = data;

            data.forEach(i =>{allItems.push(i);})
            // console.log(allItems);
             getItemsNames();
             renderCart();
             getQRCode();

        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        })

}
</script>

    <script>

        function getQRCode(){
             document.getElementById("qrcode").innerHTML = '';

            let qrcode = new QRCode(document.getElementById("qrcode"), {
                text: window.location.href,
                width: 226,
                height: 226,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

        }

        let cart = [];
        
        function renderCart() {
            if (cart.length === 0)
                return;

            const cartDiv = document.getElementById('cartItemsId');
            cartDiv.innerHTML = ''; // clear old items

            // let total=0;
            cart.forEach(item => {

                // Create the outer container
                let container = document.createElement('div');
                container.className = 'cartItemContainter';

                // Left picture div
                let left = document.createElement('div');
                left.className = 'leftpic';

                let img = document.createElement('img');
                img.src = item.image_url;
                img.alt = item.name;

                let img2 = document.createElement('img');
                img2.src = item.image_url;


                if (item.pan_size[0] === 'H') {
                    img2.classList.add('blurred');
                    left.appendChild(img2);
                }
                left.appendChild(img);

                // Right name/qty div
                let right = document.createElement('div');
                right.className = 'rightname';
                right.style.position = "relative";

                let nameP = document.createElement('p');
                nameP.textContent = item.name;

                let pane_size = document.createElement('p');
                pane_size.classList.add('pan_text');
                
            if(item.id >= 700 && item.id < 800)
                pane_size.textContent = item.pan_size[0] === 'H' ? "Half Dozen" : "Dozen";
            else
                pane_size.textContent = item.pan_size[0] === 'H' ? "Half Pan" : "Full Pan";

                let qtyP = document.createElement('p');
                qtyP.textContent = `Quantity: ${item.quantity}`;
                qtyP.style.fontSize = "13px";
                qtyP.style.position = "absolute";
                qtyP.style.bottom = "0";

                right.appendChild(nameP);
                right.appendChild(pane_size);
                right.appendChild(qtyP);

                // Put it all together
                container.appendChild(left);
                container.appendChild(right);

                // Add to cart div
                cartDiv.appendChild(container);

                // console.log(item);
                // console.log(item.full_pan_cost);

                // console.log(item.pan_size[0]);

                if((item.pan_size=="Full Pan") || (item.pan_size=="Dozen")){
                    total += item.quantity * item.full_cost;
                }
                else if((item.pan_size=="Half Pan") || (item.pan_size=="Half Dozen")){
                    total += item.quantity * item.half_cost;
                }
                else{
                    total="N/A";
                    return;
                }

                // total += item.quantity * item.price;
            });

            document.getElementById('total_id').innerHTML = `Total: $${total}`;

        }

    </script>

    <script>
let total=0;
function getItemsNames(){
    cart.forEach(item =>{

        const it = allItems.find(i => i.id === item.id);

        if(it){
                item.name = it.name_english;
                item.image_url = "https://samuelg900.github.io/ElsiliasKitchen/" + it.image_link;
                item.full_cost = it.full_pan_cost;
                item.half_cost = it.half_pan_cost;

                // console.log(item);
                // total += i.quantity * item.price;
            

        }else{//not found
                return false;
        }

    });

            // document.getElementById('total_id').innerHTML = `Total: $${total}`;
    return true;
}

function goHome(){
                window.location.href="https://samuelg900.github.io/ElsiliasKitchen/home.html";
            }


window.onload = function() {

    let hash;

   if(DEBUG_MODE === DEBUG.NO)
        hash = window.location.hash;
    else{
        hash = "#4/00102f1/10102h1/00700f1/10700h1/@";  
        // hash = "#2/00302f2/00601f1/@";  
    }
    const regex = /^#(\d+)\/((?:\d{5}[fh]\d\/)+)@$/;
    const match = regex.exec(hash);

if (match) {
        const count = parseInt(match[1], 10);   // number of items
        const itemsStr = match[2];              // whole "00100f1/.../"
        const items = itemsStr.split('/').filter(Boolean); // ["00100f1", "00101f1", "10101h1"]
    const blank_name = "";
    const image_url = "";
    const full_cost ="";
    const half_cost="";
        // ‚úÖ Build summary
        let summaryHtml = `<h2>Order Summary</h2><ul>`;
        items.forEach(item => {
            let id = parseInt(item.slice(0,5));    // "00100"
            if(id > 10000)
                id -= 10000;
            let pan_size;
            if(id >= 700 && id < 800)
                pan_size = item[5] === 'f' ? "Dozen" : "Half Dozen";
            else
                pan_size = item[5] === 'f' ? "Full Pan" : "Half Pan";
            

            const quantity = item[6];           // "1"
            summaryHtml += `<li>Item ID: ${id}, Size: ${pan_size}, Qty: ${quantity}</li>`;
        cart.push({id, blank_name, pan_size, quantity, image_url, full_cost, half_cost});
        
        });
        summaryHtml += `</ul>`;

            getJsonData();

//         if(getItemsNames()===false){
           
//  document.body.innerHTML = "<h2>Page not found</h2>";
//             return;
//         }
//         else{
//         }


        // document.body.innerHTML = summaryHtml;

        // Optional: sanity check ‚Äî does count match actual number of items?
        if (items.length !== count) {
            document.body.innerHTML = "<h2>Invalid order link.</h2>";
        }
    } else { 
        // Not a valid QR link --> show default 404
         document.body.innerHTML = `<style>

    .container{
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    position:absolute;
    top:50%;
    transform: translate(0%,-50%);
        text-align: center;
         background: white;
         border-radius:16px;
         width: 300px;
         height: 420px;
         box-shadow: rgb(38, 57, 77) 0px 20px 30px -10px;
    }

    h1{
    margin:10px 0 10px 0;
        color: #D97706;
        font-size: 80px;
    }

    h2{
        color: black;
    }

    button{
    text-decoration: none;
    color:white;
        background-color: orange;
        padding:8px 16px;
        border-radius: 50px;
        width: fit-content;
        height: 40px;
        border:none;
        cursor:pointer;
        margin-block: 10px 30px;
        text-align:center;
        transition: transform 0.5s ease;
        font-size:16px;
        box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px;
    }

    button:hover{
        transform:scale(1.1);
     }

     p{
        margin-inline:20px;
     }

    .food{
        width:fit-content;
        font-size:70px;
        transition: transform 1.5s ease-in-out;
    }

    .food:hover{
        transform: rotate(360deg);
    }


</style>

<div class="container">

    <div class="food">ü•ê</div>

            <h1>
                404
            </h1>

            <h2>
                Order Not Found!
            </h2>

            <p>Oh no! Oops! OMG! Seems like there's an issue with this order's URL</p>

            <button onclick="goHome()">
                Go Back to Homepage
            </button>


</div>`;
        // document.body.innerHTML = `
        // <div style="background-color:white; border-radius: 10px; position:absolute; top:50%; transform: translate(0%, -50%); text-algin:center; padding:40px;">
        // <h2 style="margin:0;color:black;">üëåPage not found</h2>
        // </div>`;
    }
}
</script>

<style>
* {
    -webkit-tap-highlight-color: transparent;
}
</style>


</body>

</html>