<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat" rel="stylesheet">
    
    <link rel="icon" type="image/png" href="tab_logo.png">
 
    <title>Home</title>

    <script src="home_script.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<script>

    //refresh content
    function changeLanguage(){
        const ball = document.getElementById('ball_id');
        ball.classList.toggle("changeToSpanish");
        updateLayout();
    }
</script>
    
           <script>

            let cart = [];

            function addToCart(id, name, sp_name, image, pan_size, price, cart_button, fullpan, halfpan) {
               
                if(pan_size == 2)
                    id +=10000;

                if(cart.find(i => i.id === id)){
                    return false;   
                }
                    cart.push({id, name, sp_name, image, quantity: 1, pan_size, price, cart_button,fullpan, halfpan});

                return true;
            }


            function clearFromCart(id){
                
                const pan_item = cart.find(i => i.id === id);
                if(pan_item){

                    if(pan_item.cart_button.classList.contains('disableAddToCart')) //it should
                        
                    if((pan_item.pan_size == 1 && pan_item.fullpan.classList.contains('active')) || (pan_item.pan_size == 2 && pan_item.halfpan.classList.contains('active')))
                        pan_item.cart_button.classList.remove('disableAddToCart');

                cart = cart.filter(i => i.id !== id);
                renderCart();
                }
            }

            </script>

    <script>
        function openCartContents() {

            let carty = document.getElementById("cart_contents_id");

            if (carty.style.display === "block") {
                carty.style.display = "none";
            } else {
                carty.style.display = "block";

                if (cart.length === 0) {

                    document.getElementById('nothing_in_cart').style.display = 'block'; 
                    document.getElementById('cartItemsId').style.display = 'none'; 
                    document.getElementById('checkoutBtn').classList.remove('enabled');


                } else {

                    document.getElementById('nothing_in_cart').style.display = 'none'; 
                    document.getElementById('cartItemsId').style.display = 'block';
                    document.getElementById('checkoutBtn').classList.add('enabled');

                }
            }

        }
    </script>

    <script>

function updateTotal() {
  let newTotal = 0;
  let cartCounter = 0;
  cart.forEach(item => {
    newTotal += item.quantity * item.price;
    cartCounter += item.quantity;
  });

    document.getElementById('total_of_order_id').innerHTML = `Total: $${newTotal}`;

  if(cart.length != 0){
    document.getElementById('cart_num_id').innerHTML = cartCounter;
    document.getElementById('checkoutBtn').classList.add('enabled');
  }
  else{
    document.getElementById('cart_num_id').style.display = 'none';

       document.getElementById('nothing_in_cart').style.display = 'block'; 
       document.getElementById('cartItemsId').style.display = 'none';
       document.getElementById('checkoutBtn').classList.remove('enabled');

    return;
  }
  
}

        function renderCart() {
            if(cart.length == 0)
                return;

  const cartDiv = document.getElementById('cartItemsId');
  cartDiv.innerHTML = ''; // clear old items

  cart.forEach(item => {

    // Create the outer container
    let container = document.createElement('div');
    container.className = 'cartItemContainter';

    // Left picture div
    let left = document.createElement('div');
    left.className = 'leftpic';

    let img = document.createElement('img');
    img.src = item.image;
    img.alt = item.name;

    let img2 = document.createElement('img');
    img2.src = item.image;

    if (item.pan_size == 2) {
      img2.classList.add('blurred');
      left.appendChild(img2);
    }
    left.appendChild(img);

    // Right name/qty div
    let right = document.createElement('div');
    right.className = 'rightname';
    right.style.position = "relative";

    let nameP = document.createElement('p');
    nameP.textContent = item.name;

    let pane_size = document.createElement('p');
    pane_size.classList.add('pan_text');

    if(document.getElementById('ball_id').classList.contains('changeToSpanish')){
        pane_size.textContent = item.pan_size == 2 ? "Media Bandeja" : "Bandeja Entera";
        nameP.textContent = item.sp_name;
    }
    else
        pane_size.textContent = item.pan_size == 2 ? "Half Pan" : "Full Pan";


    let qtyP = document.createElement('p');
    qtyP.textContent = `Qty: ${item.quantity}`;
    qtyP.style.fontSize = "14px";
    qtyP.style.position = "absolute";
    qtyP.style.bottom = "0";

    const cartMinusSign = document.createElement('span');
    cartMinusSign.className = 'cartMinusSign';
    cartMinusSign.textContent = '\u2212';

    const cartTrashIcon = document.createElement('span');
    cartTrashIcon.className = 'material-symbols-outlined cartTrashIcon';
    cartTrashIcon.textContent = 'delete';

    const cartPlusSign = document.createElement('span');
    cartPlusSign.className = 'cartPlusSign';
    cartPlusSign.textContent = '\u002b';

    const cartPlusMinusDiv = document.createElement('div');
    cartPlusMinusDiv.className = 'cartPlusMinusDiv';
    cartPlusMinusDiv.appendChild(cartMinusSign);
    cartPlusMinusDiv.appendChild(cartTrashIcon);
    cartPlusMinusDiv.appendChild(cartPlusSign);


    cartMinusSign.addEventListener('click', () => {
        
        if(item.quantity === 1){
            clearFromCart(item.id);
            container.remove();
        }else{
            // item.quantity--;
            --item.quantity;
            qtyP.textContent = `Qty: ${item.quantity}`;
            // renderCart();
        }
        updateTotal();
    });


    cartPlusSign.addEventListener('click', () => {
        
        if(item.quantity < 3){
            ++item.quantity
            qtyP.textContent = `Qty: ${item.quantity}`;
            // renderCart();
        }
        updateTotal();
    });

    cartTrashIcon.addEventListener('click', () => { 
        clearFromCart(item.id)
        container.remove();
        updateTotal();
    });


    right.appendChild(nameP);
    right.appendChild(pane_size);
    right.appendChild(qtyP);
    right.appendChild(cartPlusMinusDiv);

    // Put it all together
    container.appendChild(left);
    container.appendChild(right);

    // Add to cart div
    cartDiv.appendChild(container);
  });

  updateTotal();
 
}

    </script>

    <script>

function closeQRWindow(){
    document.getElementById('qrcode-div-id').style.display = 'none';
}


function createQRLink(){
    let qr_str = 'https://samuelg900.github.io/ElsiliasKitchen/home.html/#' + cart.length + '/';
    let pansize;

    cart.forEach(item => {

        if(item.pan_size == 1)
            pansize = 'f';
        else
            pansize = 'h';
    
        qr_str += item.id + pansize + item.quantity + '/'; 

    });

    // console.log(qr_str + '@');
    return qr_str += '@';

}


function getQRDateTime(){    

    const date = new Date();
    // document.getElementById('currentDateId').innerHTML = `${date.getMonth()}/${date.getDate()}/${date.getFullYear()} `;
    document.getElementById('currentDateId').innerHTML = `${date.toDateString()} <br> ${date.toLocaleTimeString()}`;

}

// stage/state -- if back is pressed


function checkoutBtnFunc(){

    if(cart.length === 0) return;

    // createQRLink();

    document.getElementById('qrcode-div-id').style.display='flex';

    document.getElementById("qrcode").innerHTML='';

    let qrcode = new QRCode(document.getElementById("qrcode"), {
                    text: createQRLink(),
                    width: 256,
                    height: 256,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.L
                });

    getQRDateTime();

    openCartContents();

}
    </script>

    <div class="top_nav">

     <div class="languageContainer">
        <div class="switchLanguage" onclick="changeLanguage()">
        <img class="usa" src="USA_flag.png" alt="">
             <div class="switchBall" id="ball_id"></div>
        <img class="dr" src="DR_flag.png" alt="">
        </div>
     </div>
        
        <h3 style="position: absolute; top: 10%; left: 50%; transform: translate(-50%, -50%); color: aliceblue;">
            Elsilia's Kitchen</h3>
        <div id="cart_num_id">0</div>
        <span class="material-symbols-outlined cart_icon" onclick="openCartContents()">shopping_cart</span>
    </div>

    <div id="cart_contents_id">
        <div class="cartContent">
            <div id="nothing_in_cart">Cart is empty</div>
            <div class="cartItems" id="cartItemsId">
            </div>
        </div>
        <div class="checkout">
            <p id="total_of_order_id">Total: $0</p>
            <button id="checkoutBtn" onclick="checkoutBtnFunc()">Checkout</button>
        </div>


    </div>

    <div class="conig" style="max-height: 500px; overflow: hidden;">
        <img class="ig" style="width: 100%;" src="banner.png">
        <div class="p_container">
            <p class="syncopate-bold">Elsilia's<br>Kitchen</p>
            <p class="caveat">Delicious Dominican food, from our home to yours</p>
        </div>
    </div>


    <script>
        let numOfOrders = 0; 
        let orderTotal = 0;
    </script>



    <div class="body_content">


        <br>
        <br>
        <br>

        <div id="image_viewer_window">
            <img class="image_viewer" src="">
            <div class="image_icon_container">
                <span class="close_icon" onclick="closeImageViewer()" alt="close">&times;</span>
            </div>
        </div>

        <script>
            function closeImageViewer() {
                document.getElementById('image_viewer_window').style.display = 'none';
            }

            function openImageViewer(imageSrc) {
                document.querySelector('.image_viewer').src = imageSrc;
                document.getElementById('image_viewer_window').style.display = 'block';
            }

            window.addEventListener('keydown', function (event) {

                // Example: Close modal with Escape key
                if (event.key === 'Escape') {
                    if (document.getElementById('image_viewer_window').style.display === 'block') {
                        document.getElementById('image_viewer_window').style.display = 'none';
                    }
                }
            });

        </script>

        <!-- https://www.figma.com/community/file/1294173080512093987/food-website-design -->
 

        <div class="menu" id="menu">
            <section class="category">
                <h1>Rice</h1>
                <div class="tempContainer" id="menu-arroz"></div>
            </section>

            <section class="category">
                <h1>Meats</h1>
                <div class="tempContainer" id="menu-carne"></div>
            </section>

            <section class="category">
                <h1>Pastas</h1>
                <div class="tempContainer" id="menu-pasta"></div>
            </section>

            <section class="category">
                <h1>Roots</h1>
                <div class="tempContainer" id="menu-viveres"></div>
            </section>
            
            <section class="category">
                <h1>Finger Food</h1>
                <div class="tempContainer" id="menu-picadera"></div>
            </section>

        </div>


        <script>
            getJsonData();
        </script>

        <p id="disclaimerTextId">Each whole pan is enough for approximately 35-38 people</p>

        <div id="qrcode-div-id">  
            <span id="currentDateId"></span>
            <span class="close_qrcode_window" onclick="closeQRWindow()">&times;</span>
            <h1>Elsilia's Kitchen Order</h1>
            <div id="qrcode"></div>
            <p>Please Save and Send this QR Code to <strong>Elsa</strong> to confirm your order and set up an order date</p>
            <button id="save-qr-button">Save QR Code</button>
        </div>

        <script>
        function generatePdf() {
            const doc = new jspdf.jsPDF();
            doc.text("Hello, this is a generated PDF!", 10, 10);
            doc.save("myDocument.pdf");
        }
    </script>
    <button onclick="generatePdf()">Generate PDF</button>

    </div>

</body>

</html>
