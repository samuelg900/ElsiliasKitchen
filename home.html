<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat" rel="stylesheet">

    <link rel="icon" type="image/png" href="tab_logo.png" />
<script src="debug.js"></script>
    <title>Home</title>

    <script src="home_script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.3/jspdf.umd.min.js"></script>

</head>

<body>



<div id="loading_div">
    <svg id="e_id" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <path
            fill="#D35A21"
            d="
            M10,40 A30,30 0 0 1 40,10 L90,10 L90,30 L40,30 A10,10 0 0 0 30,40 L85,40 L85,60 L30,60 A10,10 0 0 0 40,70 L90,70 L90,90 L40,90 A30,30 0 0 1 10,60 Z"
        />
    </svg>
    <svg id="k_id" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <polygon points="10,10 30,10 30,40 40,40 65,10 91,10 55,50 91,90 65,90 40,60 30,60 30,90 10,90" fill="#D35A21"></polygon>
    </svg>
</div>
    <script>
          if(DEBUG_MODE == DEBUG.YES){
            document.getElementById('loading_div').style.display='none';
          }

    </script>

<style>
#loading_div{
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom: 0;
    width: 101%;/* made these 101% because rendering had a tiny gap to the right*/
    height: 101%; /* and bottom of the screen (showing the background)*/
    background-color: #1a1a1a;
    z-index: 30;
    
  animation: opac 1.5s linear forwards;
  animation-delay: 4s;
}

@keyframes opac {
    from{
        opacity: 1;
    }
    to {
        opacity: 0;
        z-index: -1;
    }
}

#e_id {
  position: absolute;
  z-index: 100;
  animation: bezier_curve_move 2s ease-out forwards, rot_e 1.5s ease-out forwards;
  animation-delay: 0s, 2.1s;
}

#k_id {
  position: absolute;
  z-index: 100;
  animation: bezier_curve_move 2s ease-out forwards, rot_k 1.5s ease-out forwards;
  animation-delay: 0s, 2.1s;
}

@keyframes rot_e {
    from{
        transform: rotate(0deg);
        left:0px;
    }
    to{
        transform: rotate(-90deg);
        left:-7.5%;
        top: auto;
    }
}

@keyframes rot_k {
    from{
        transform: rotate(0deg);
        left:0px;
    }
    to{
        transform: rotate(90deg);
        left:6.5%;
    }
}

@keyframes bezier_curve_move {
    from{
        transform: rotate(270deg);
    }
  to {
        offset-distance: 100%;
        transform: rotate(0deg);
  }

}

</style>

    <script>

        // const ua = navigator.userAgent;

        // const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
        // const isMacOS = /Macintosh/.test(ua) && !/iPhone|iPad|iPod/.test(ua);

        // Doesn't show animation for IOS or MacOS...until i can fix the centering/Bezier curve in their system
        // if(isIOS || isMacOS){
        //     document.getElementById('loading_div').style.display="none";
        // }
        // else{

                let pathE;
                let pathK;

                    const outer_vert_space = (window.innerHeight - window.innerWidth) / 2;

                    //path for E
                    let P1 = `M0 ${window.innerHeight - outer_vert_space} `;
                    let P2 = `C${window.innerWidth} ${window.innerHeight/2}, `;
                    let P3 = `${window.innerWidth/2} ${outer_vert_space}, `;
                    let P4 = `${window.innerWidth/2} ${window.innerHeight/2}`;
                    pathE = P1 + P2 + P3 + P4;

                    document.getElementById("e_id").style.offsetPath=`path("${pathE}"`;
                    document.getElementById("e_id").style.width=`${window.innerWidth * 0.15}px`;
                    document.getElementById("e_id").style.height=`${window.innerWidth * 0.15}px`;

                    //path for K
                    P1 = `M${window.innerWidth} ${outer_vert_space} `;
                    P2 = `C0 ${window.innerHeight/2}, `;
                    P3 = `${window.innerWidth/2} ${window.innerHeight - outer_vert_space}, `;
                    P4 = `${window.innerWidth/2} ${window.innerHeight/2}`;
                    pathK= P1 + P2 + P3 + P4;

                    document.getElementById("k_id").style.offsetPath=`path("${pathK}"`;
                    document.getElementById("k_id").style.width=`${window.innerWidth * 0.15}px`;
                    document.getElementById("k_id").style.height=`${window.innerWidth * 0.15}px`;
            // }
    </script>


    <script>

        //refresh content
        function changeLanguage() {
            const ball = document.getElementById('ball_id');
            ball.classList.toggle("changeToSpanish");
            updateLayout();
        }
    </script>

    <script>


     window.addEventListener('beforeunload', function (e) {
        if(cart.length > 0 && DEBUG_MODE == DEBUG.NO){
            
            // i believe this is needed for modern browsers
            e.preventDefault(); 

            //chrome requires the returnValue to be set (this is for old browsers)
            e.returnValue = 'Cart is not empty. Are you sure you want to leave?'; 
        }
});

        let cart = [];

        function addToCart(id, name, sp_name, image, pan_size, price, cart_button, fullpan, halfpan) {

            if (pan_size === 2)
                id += 10000;

            if (cart.find(i => i.id === id))
                return false;
            
            cart.push({id, name, sp_name, image, quantity: 1, pan_size, price, cart_button, fullpan, halfpan});

            return true;
        }


        function clearFromCart(id) {

            const cart_item = cart.find(i => i.id === id);
            if (cart_item) {

                //remove item from cart
                cart = cart.filter(i => i.id !== id);
                renderCart();
                updateTotal();
                
                //change add to cart icon if needed
                if(cart_item.cart_button.classList.contains('itemWasAdded'))
                    if((cart_item.pan_size == 1 && cart_item.fullpan.classList.contains('active')) || (cart_item.pan_size == 2 && cart_item.halfpan.classList.contains('active')))                        
                        cart_item.cart_button.classList.toggle('itemWasAdded');
                
                return true;
            }

            return false;
        }

    </script>

    <script>
        function openCartContents() {

            //close message box if open
            if(document.getElementById("saveContainerId").classList.contains("show"))
                document.getElementById("saveContainerId").classList.toggle("show");
        

            document.querySelector('.cart').classList.toggle('open');
            
                if (cart.length === 0) {

                    document.getElementById('add_message').style.display = 'none';
                    document.getElementById('nothing_in_cart').style.display = 'block';
                    document.getElementById('cartItemsId').style.display = 'none';
                    document.getElementById('checkoutBtn').classList.remove('enabled');


                } else {
                    document.getElementById('add_message').style.display = 'block';
                    document.getElementById('nothing_in_cart').style.display = 'none';
                    document.getElementById('cartItemsId').style.display = 'block';
                    document.getElementById('checkoutBtn').classList.add('enabled');

                }
        }
    </script>

    <script>

        function updateTotal() {
            let newTotal = 0;
            let cartCounter = 0;
            cart.forEach(item => {
                newTotal += item.quantity * item.price;
                cartCounter += item.quantity;
            });

            document.getElementById('total_of_order_id').innerHTML = `Total: $${newTotal}`;

            if (cart.length != 0) {
                document.getElementById('cart_num_id').innerHTML = cartCounter;
                document.getElementById('checkoutBtn').classList.add('enabled');
            }
            else {
                document.getElementById('cart_num_id').style.display = 'none';
                document.getElementById('add_message').style.display = 'none';
                document.getElementById('nothing_in_cart').style.display = 'block';
                document.getElementById('cartItemsId').style.display = 'none';
                document.getElementById('checkoutBtn').classList.remove('enabled');

                return;
            }

        }

        function renderCart() {
            if (cart.length == 0){
                document.getElementById("textareaId").value = '';
                document.getElementById("saveMessageButtonId").style='background-olor:rgba(57, 57, 57, 0.545);';
                savedMessage = undefined;
                document.getElementById("add_message").style.color="black";
                document.getElementById('add_message').style.display = 'none';
                document.getElementById('nothing_in_cart').style.display = 'block';
                document.getElementById('cartItemsId').style.display = 'none';
                document.getElementById('checkoutBtn').classList.remove('enabled');
                updateTotal();
                return;
            }

            const cartDiv = document.getElementById('cartItemsId');
            cartDiv.innerHTML = ''; // clear old items

            cart.forEach(item => {

                // Create the outer container
                let container = document.createElement('div');
                container.className = 'cartItemContainter';

                // Left picture div
                let left = document.createElement('div');
                left.className = 'leftpic';

                let img = document.createElement('img');
                img.src = item.image;
                img.alt = item.name;

                let img2 = document.createElement('img');
                img2.src = item.image;

                if (item.pan_size == 2) {
                    img2.classList.add('blurred');
                    left.appendChild(img2);
                }
                left.appendChild(img);

                // Right name/qty div
                let right = document.createElement('div');
                right.className = 'rightname';
                right.style.position = "relative";

                let nameP = document.createElement('p');
                nameP.textContent = item.name;

                let pane_size = document.createElement('p');
                pane_size.classList.add('pan_text');

                if (document.getElementById('ball_id').classList.contains('changeToSpanish')) {
                    pane_size.textContent = item.pan_size == 2 ? "Media Bandeja" : "Bandeja Entera";
                    nameP.textContent = item.sp_name;
                }
                else
                    pane_size.textContent = item.pan_size == 2 ? "Half Pan" : "Full Pan";


                let qtyP = document.createElement('p');
                qtyP.style.fontSize = "14px";
                qtyP.style.position = "absolute";
                qtyP.style.bottom = "0";
                if (document.getElementById('ball_id').classList.contains('changeToSpanish'))
                    qtyP.textContent = `Cantidad: ${item.quantity}`;
                else
                    qtyP.textContent = `Quantity: ${item.quantity}`;

                const cartMinusSign = document.createElement('span');
                cartMinusSign.className = 'cartMinusSign';
                cartMinusSign.textContent = '\u2212';

                const cartTrashIcon = document.createElement('span');
                cartTrashIcon.className = 'material-symbols-outlined cartTrashIcon';
                cartTrashIcon.textContent = 'delete';

                const cartPlusSign = document.createElement('span');
                cartPlusSign.className = 'cartPlusSign';
                cartPlusSign.textContent = '\u002b';

                const cartPlusMinusDiv = document.createElement('div');
                cartPlusMinusDiv.className = 'cartPlusMinusDiv';
                cartPlusMinusDiv.appendChild(cartMinusSign);
                cartPlusMinusDiv.appendChild(cartTrashIcon);
                cartPlusMinusDiv.appendChild(cartPlusSign);


                cartMinusSign.addEventListener('click', () => {

                    if (item.quantity === 1) {
                        clearFromCart(item.id);
                    } else {
                        --item.quantity;
                        if (document.getElementById('ball_id').classList.contains('changeToSpanish'))
                            qtyP.textContent = `Cantidad: ${item.quantity}`;
                        else
                            qtyP.textContent = `Quantity: ${item.quantity}`;
                    }

                    if(item.quantity < 3)
                            cartPlusSign.style = "color:black;"
                        else
                            cartPlusSign.style = "color:#00000050;"

                     updateTotal();
                });


                cartPlusSign.addEventListener('click', () => {

                    if (item.quantity < 3) {
                        ++item.quantity
                        if (document.getElementById('ball_id').classList.contains('changeToSpanish'))
                            qtyP.textContent = `Cantidad: ${item.quantity}`;
                        else
                            qtyP.textContent = `Quantity: ${item.quantity}`;
                         updateTotal();
                       
                        if(item.quantity === 3)
                            cartPlusSign.style = "color:#00000050;"
                        else
                            cartPlusSign.style = "color:black;"
                       
                    }else{
                        
                    } 
                });

                cartTrashIcon.addEventListener('click', () => {                    
                    clearFromCart(item.id);
                });


                right.appendChild(nameP);
                right.appendChild(pane_size);
                right.appendChild(qtyP);
                right.appendChild(cartPlusMinusDiv);

                // Put it all together
                container.appendChild(left);
                container.appendChild(right);

                // Add to cart div
                cartDiv.appendChild(container);
            });

            updateTotal();

        }

    </script>

    <script>

        function closeQRWindow() {
            document.getElementById('qrcode-div-background-id').style.display = 'none';
        }


        function createQRLink() {

            let qr_str;

            if(DEBUG_MODE == DEBUG.NO)
                qr_str = 'https://samuelg900.github.io/ElsiliasKitchen/404.html#' + cart.length + '/';
            else
                qr_str = 'http://127.0.0.1:5500/home.html/#' + cart.length + '/';
            
            let pansize;

            cart.forEach(item => {

                if (item.pan_size == 1)
                    pansize = 'f';
                else
                    pansize = 'h';

                qr_str += String(item.id).padStart(5,'0') + pansize + item.quantity + '/';

            });
        console.log(qr_str + '@');
            return qr_str += '@';

        }


        function getQRDateTime() {
            const date = new Date();
            document.getElementById('currentDateId').style='font-size: 16px;'
            document.getElementById('currentDateId').innerHTML = `${date.toDateString()} <br> ${date.toLocaleTimeString()}`;

        }   

        // TODO: stage/state -- if back is pressed


        function checkoutBtnFunc() {

            //close message box if open
            if(document.getElementById("saveContainerId").classList.contains("show"))
                document.getElementById("saveContainerId").classList.toggle("show");

            if (cart.length === 0) return;

            document.getElementById('qrcode-div-background-id').style.display = 'block';

            document.getElementById("qrcode").innerHTML = '';

            let qrcode = new QRCode(document.getElementById("qrcode"), {
                text: createQRLink(),
                width: 256,
                height: 256,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            // #D25A21

            getQRDateTime();

            if(savedMessage != undefined){
                if (document.getElementById('ball_id').classList.contains('changeToSpanish'))
                    document.getElementById('p_for_saved_message').innerHTML = `Notas:<br>${savedMessage}`;
                else
                    document.getElementById('p_for_saved_message').innerHTML = `Notes:<br>${savedMessage}`;
                document.getElementById('p_for_saved_message').style="display:block; font-size:12px; font-style: italic; text-align: center; margin: 20px; overflow-wrap: break-word; word-break: break-all";
            }
            else
                document.getElementById('p_for_saved_message').style.display='none';

            document.querySelector('.cart').classList.toggle('open');
        }
    </script>
        <style>
            .divl{
               align-self: center;
            }
            
            .divm{
                display: flex;
                /* margin-block: 9px;
                margin-inline:4px; */
                /* justify-self: auto; */
                /* position: absolute; */
                height: 76px;
                width: 76px;
                /* transform: rotate(-10deg); */


                /* position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); */
            }

            #ee{
                /* position: absolute; */
                
                height: 100%;
                width: auto;
                /* transform: rotate(-10deg); */
            }

            #kk{
                /* position: relative;
                left: 37px; */
                height: inherit;
                width: inherit;
            }

            .divr{
                display: flex;
                align-items: center;
                /* position: relative; */
                /* width: fit-content;
                
                height: 36px; */
                /* width: 306px; */
            }

        </style>

<div class="top_nav">

    <div class="divl">
        <div class="languageContainer">
            <div class="switchLanguage" onclick="changeLanguage()">
                <img class="usa" src="USA_flag.png" alt="">
                <div class="switchBall" id="ball_id"></div>
                <img class="dr" src="DR_flag.png" alt="">
            </div>
        </div>
    </div>

    <div class="divm">
        <!-- E -->
        <svg id="ee" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
           
            <path stroke="var(--primary-dark)" stroke-width="6" fill="none"
                d="M10,40 A30,30 0 0 1 40,10 L90,10 L90,30 L40,30 A10,10 0 0 0 30,40 L85,40 L85,60 L30,60 A10,10 0 0 0 40,70 L90,70 L90,90 L40,90 A30,30 0 0 1 10,60 Z" />
        </svg>
            <!-- K -->
        <svg id="kk" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <polygon points="10,10 30,10 30,40 40,40 65,10 91,10 55,50 91,90 65,90 40,60 30,60 30,90 10,90"
                stroke="var(--primary-dark)" stroke-width="6" fill="none"></polygon>
        </svg>

    </div>



    <!-- <h3 style="position: absolute; top: 10%; left: 50%; transform: translate(-50%, -50%); color: white;">
Elsilia's Kitchen</h3> -->
    <div class="divr">
        <div id="cart_num_id">0</div>
        <span class="material-symbols-outlined cart_icon" onclick="openCartContents()">shopping_cart</span>
    </div>
</div>

    <div class="cart" id="cart_contents_id">
        <div class="cartContent">
            <div id="nothing_in_cart">Cart is empty</div>
            <div class="cartItems" id="cartItemsId">
        </div>
            <div class="checkout_div">
                <p id="total_of_order_id">Total: $0</p>
                <a id="add_message" onclick="openAddMessage(2)">Add message...</a>
                <button id="checkoutBtn" onclick="checkoutBtnFunc()">Checkout</button>
            </div>
        </div>

        <div id="saveContainerId">
            <textarea id="textareaId" placeholder="Add food details if needed..." rows="2" cols="40"></textarea>
            <div class="save_div">
                <button id="cancelMessageButtonId" type="button" onclick="openAddMessage(0)">Cancel</button>
                <p id="labelId" style="color: white;">0/200</p>
                <button id="saveMessageButtonId" onclick="saveAddedMessage()" type="button">Save</button>
            </div>
        </div>
        
    </div>

    <div class="conig" style="max-height: 500px; overflow: hidden;">
        <img class="ig" style="width: 100%;" src="banner.png">
        <div class="p_container">
            <p class="syncopate-bold">Elsilia's<br>Kitchen</p>
            <p class="caveat">Delicious Dominican food,<br>from our home to yours</p>
        </div>
    </div>


    <script>
        let numOfOrders = 0;
        let orderTotal = 0;
    </script>



    <div class="body_content">

        <div id="image_viewer_window">
            <img class="image_viewer" src="">
            <div class="image_icon_container">
                <span class="close_icon" onclick="closeImageViewer()" alt="close">&times;</span>
            </div>
        </div>

        <script>
            function closeImageViewer() {
                document.getElementById('image_viewer_window').style.display = 'none';
            }

            function openImageViewer(imageSrc) {
                document.querySelector('.image_viewer').src = imageSrc;
                document.getElementById('image_viewer_window').style.display = 'block';
            }

            window.addEventListener('keydown', function (event) {

                // Example: Close modal with Escape key
                if (event.key === 'Escape') {
                    if (document.getElementById('image_viewer_window').style.display === 'block') {
                        document.getElementById('image_viewer_window').style.display = 'none';
                    }
                }
            });

        </script>

        <div class="menu" id="menu">
            <section class="category">
                <h1 id="title_rice_id">Rice</h1>
                <div class="tempContainer" id="menu-arroz"></div>
            </section>

            <section class="category">
                <h1 id="title_meats_id">Meats</h1>
                <div class="tempContainer" id="menu-carne"></div>
            </section>

            <section class="category">
                <h1 id="title_pasta_id">Pastas & Salads</h1>
                <div class="tempContainer" id="menu-pasta"></div>
            </section>

            <section class="category">
                <h1 id="title_roots_id">Roots</h1>
                <div class="tempContainer" id="menu-viveres"></div>
            </section>

            <section class="category">
                <h1 id="title_fingerfood_id">Finger Food</h1>
                <div class="tempContainer" id="menu-picadera"></div>
            </section>

        </div>



            <!-- scroll bar -->

        <script>
//hover == add class
//id -> item  ..switch

//active == add class

  
//   const scroll_item = document.getElementById('scrill_div_Id');

  function scrollFunc(menu_id){
    
    // document.getElementById(menu_id).scrollIntoView();
    
    hidePieTitleSelector();

    const elementPosition = document.getElementById(menu_id).getBoundingClientRect().top + window.scrollY;
    const offsetPosition = elementPosition - 80;

    window.scrollTo({
        top: offsetPosition
        // behavior: 'smooth' // remove if you want instant scroll
    });


  }

        </script>
        
        <style>

.xx{
    width: auto;
    transform: width 1s;
}
    .xx:hover{
        transform: scale(1.5);
    }
    
    .my-polygon-shape {
      /* Other styles for the element */
      width: 100px;
      height: 100px;
      background-color: blue;
      
      /* Apply the polygon shape using clip-path */
      clip-path: polygon(50% 50%, 0% 100%, 0% 80%); /* Example: a diamond shape */
    }

    </style>

            <div id="pie_container"></div>

<script>
              const navigation_pie = document.getElementById('pie_container');
let timeout;

// 1. SCROLL LISTENER (Modified slightly)
window.addEventListener('scroll', () => {
    
    //resets current timeouts set
    clearTimeout(timeout);
        navigation_pie.classList.add('active');
    
    timeout =  setTimeout(() => {
        //stay open for a second
     hidePieTitleSelector();
    
    console.log('Scroll timeout - Hiding after 1 sec');
      }, 1000);

});



// 2. MOUSE ENTER/LEAVE (For desktop)
navigation_pie.addEventListener('mouseenter', () => {
    clearTimeout(timeout);
    // console.log(3);
    console.log('Mouse Enter - Keeping visible');
});

navigation_pie.addEventListener('mouseleave', () => {
    // Only start a hide timer if a touch hasn't kept it active
        timeout = setTimeout(() => {
            hidePieTitleSelector();
            // console.log(4);
            
    console.log('Mouse Leave - Hiding after short delay');
        }, 100);
});

</script>

<style>

    #nav_circle_id{
        cursor: pointer;
    }


    .pie_group{
        display: none;
        /* opacity: 0; */
    }

    .pie_group.show{
        display: block;
        /* opacity: 1; */
    }

    .slice {
        display: none;
            transition: transform 0.3s ease-out;
            opacity: 0.9;
        }
        .slice:hover {
            transform: scale(1.02);
            opacity: 1;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
            cursor: pointer;
        }
    #pie_container{ 
        position: fixed;
        top:25%;
        /* top:40vh; */

        right:-170px;
        width: 300px;
        height: 300px;
        /* transform: translate(0, -50%); */
        transition: right 0.3s ease;  
    }

     #pie_container.active {
            pointer-events: auto;
            right:-140px;
        }
      


</style>

<script>
const titlesArray = {
  titles: ["title_fingerfood_id", "title_roots_id", "title_pasta_id", "title_meats_id", "title_rice_id"],
  names: ["Finger Food", "Roots", "Salads", "Meats", "Rice"]
}

function hidePieTitleSelector(){

    document.querySelectorAll('.pie_group').forEach(item => item.classList.remove('show'));
                document.getElementById('pie_container').classList.remove('active');
                document.getElementById('pie_container').style.zIndex='1';
}

function addInteractivity(svg) {
         

        const menu = svg.querySelectorAll('.pie_group');
        const circle = svg.getElementById('nav_circle_id');
        
        svg.querySelectorAll('.slice').forEach(slice => {
                slice.addEventListener('click', (e) => {
                    const titleID = e.target.getAttribute('data-id');
                    scrollFunc(titleID);
                     menu.forEach(item => item.classList.remove('show'));
                     document.getElementById('pie_container').style.zIndex='1';
                });
        });
        // Click or touch to toggle
        circle.addEventListener('click', () => {

                  menu.forEach(item => item.classList.toggle('show'));
                  clearTimeout(timeout);

            if(document.getElementById('pie_container').style.zIndex=='9')
                hidePieTitleSelector();
            else
                document.getElementById('pie_container').style.zIndex='9'

        });

        }

function createHalfDonutPie(labels, names, options = {}) {
  const size = options.size || 200;
  const gap = options.gap || 2; // degrees between slices
  const innerRadiusRatio = options.innerRadiusRatio || 0.6;
  const radius = size / 2.05;
  const innerRadius = radius * innerRadiusRatio;

  const svgNS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgNS, "svg");
  svg.setAttribute("viewBox", `0 0 ${size} ${size}`);
  svg.style.transform = "rotate(180deg)"; // makes flat side on the left

  const sliceCount = labels.length;
  const sliceAngle = 180 / sliceCount; // divide half circle evenly

  let index=0;
  let currentAngle = 0;

  const toRadians = (angleDeg) => angleDeg * (Math.PI / 180);


    const getCoordinates = (angleDeg, radius) => {
            // Adjust angle so 0 degrees is at 12 o'clock (top of the circle)
            const adjustedAngleDeg = angleDeg - 90;
            const angleRad = toRadians(adjustedAngleDeg);
            return {
                x: radius * Math.cos(angleRad),
                y: radius * Math.sin(angleRad)
            };
        };

  labels.forEach((title_id, i) => {
    const startAngle = currentAngle + gap / 2;
    const endAngle = startAngle + sliceAngle - gap;

    const path = document.createElementNS(svgNS, "path");
    path.setAttribute("d", describeArc(radius, radius, radius, innerRadius, startAngle, endAngle));
    path.setAttribute("fill", "white");
    path.setAttribute("data-id", title_id);
    // path.setAttribute("label", "hello");
    path.classList.add("slice");
    path.classList.add("pie_group");
    // path.setAttribute("click",`scrollFunc(${title_id})`);


    // path.addEventListener("click",scrollFunc(title_id));

    svg.appendChild(path);

    const midAngle = (startAngle + endAngle) / 2;

  // Midpoint position for text
    const textPos = polarToCartesian(
      radius,
      radius,
      (radius + innerRadius) / 2,
      midAngle
    );

    // Text element
    const text = document.createElementNS(svgNS, "text");
    text.setAttribute("x", textPos.x);
    text.setAttribute("y", textPos.y);
    text.setAttribute("fill", "black");
    text.setAttribute("font-size", "5");
    text.setAttribute("text-anchor", "middle");
    text.setAttribute("alignment-baseline", "middle");
    text.setAttribute("alignment-baseline", "middle");
    text.setAttribute("pointer-events", "none");
    text.classList.add("pie_group");
    text.textContent = names[index++];

     const textRadius = (radius + innerRadius) / 2;

      // Keep text upright when on the lower half (so it doesn't flip upside-down)
    let rotation = midAngle;
    if (rotation > 90 && rotation < 270) rotation += 180;


// pick the end of the slice line (outer arc)
  let rotationAngle = midAngle - 270;

    // If the mid-angle is in the lower half (180 to 270), flip the text by 180 degrees
    // to ensure it reads upright from the inner radius outwards.
    if (midAngle > 180 && midAngle < 270) {
        rotationAngle += 180;
    }

    text.setAttribute("transform", `rotate(${rotationAngle}, ${textPos.x}, ${textPos.y})`);
        
    svg.appendChild(text);

    currentAngle += sliceAngle;
  });



      const square = document.createElementNS(svgNS, "polygon");

    const topleft = `${size/2.05},${size/2.05+6}`;
     const topright = `${size/2.05-8},${size/2.05+6}`;
      const bottomright = `${size/2.05-8},${size/2.05-6}`;
       const bottomleft = `${size/2.05},${size/2.05-6}`;


    square.setAttribute("points",`${topleft} ${topright} ${bottomright} ${bottomleft}`);
    square.setAttribute('fill', '#202020');
    square.setAttribute('stroke', 'none');

    svg.appendChild(square);


  const circle = document.createElementNS(svgNS, "circle");
    circle.setAttribute('cx', size/2.05);
    circle.setAttribute('cy', size/2.05);
    circle.setAttribute('r', 6);
    circle.setAttribute('fill', '#202020');
    circle.setAttribute('id', 'nav_circle_id');

    svg.appendChild(circle);

  for (let i = 0; i < 4; i++) {
  const rect = document.createElementNS(svgNS, "rect");
  rect.setAttribute("x", 11.8);      
  rect.setAttribute("y", 45.3 + i*2);
  rect.setAttribute("width", 40);
  rect.setAttribute("height", 0.7); 
  rect.setAttribute("fill", "white");
  rect.setAttribute("pointer-events", "none");
  svg.appendChild(rect);
}


    // svg.appendChild(iconPath);

// <svg xmlns="http://www.w3.org/2000/svg" 
// height="24px" 
// viewBox="0 -960 960 960" 
// width="24px" 
// fill="#00A5FF">
// <path d="M160-360v-80h640v80H160Zm0 160v-80h640v80H160Zm0-320v-80h640v80H160Zm0-160v-80h640v80H160Z"/>
// </svg>

  
    addInteractivity(svg);

  return svg;
}

// Helpers
function polarToCartesian(cx, cy, r, angle) {
  const rad = (angle - 90) * Math.PI / 180.0;
  return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };
}

function describeArc(cx, cy, outerR, innerR, startAngle, endAngle) {
  const startOuter = polarToCartesian(cx, cy, outerR, endAngle);
  const endOuter = polarToCartesian(cx, cy, outerR, startAngle);
  const startInner = polarToCartesian(cx, cy, innerR, startAngle);
  const endInner = polarToCartesian(cx, cy, innerR, endAngle);
  const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

  return [
    "M", startOuter.x, startOuter.y,
    "A", outerR, outerR, 0, largeArcFlag, 0, endOuter.x, endOuter.y,
    "L", startInner.x, startInner.y,
    "A", innerR, innerR, 0, largeArcFlag, 0, endInner.x, endInner.y,
    "Z"
  ].join(" ");
  
}

// --- Create and append pie ---
const pie = createHalfDonutPie(titlesArray.titles, titlesArray.names, { size: 100, gap: 2, innerRadiusRatio: 0.2 });
document.getElementById("pie_container").appendChild(pie);
</script>




        

         <!-- create pie slices on left side -->
            
        


        <!-- END -->

    <style>

        
html { scroll-behavior: smooth; } 

        #scrill_div_Id.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .scroll_spacer{
            display: flex;
            flex-direction: column;            
            background-color: white;
            width: 10px;
            height: 10px;
            margin: 0;
            border-radius: 50%;
            box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3);

        }
        .scroll_spacer:hover{
            transform: scale(1.2);
        }

        .scroll_item{
            display: flex;
            justify-content: center;
            align-items: center;  
            background-color: white;
            /* text-align: center; */
            width: 10px;
            height: 40px;
            border-radius: 5px 0 0 5px;  
            box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            overflow: hidden;
            transition: width 0.5s;
        }

        .scroll_item:hover{
            /* expand */
            width: 80px;
            transition: width 0.5s;
        }

        .scroll_item:active{
            width: 120px;
        }
    </style>


    <!-- =============== -->


        <script>
            getJsonData();
        </script>

        <p class="disclaimerText" id="size_disclaimerTextId">Each whole pan is enough for approximately 35-38 people</p>
        
        <p class="disclaimerText" id="ai_disclaimerTextId" style="font-size: 13px;">For transparency: This site used AI imaging for the images seen on the page. If you'd like to see some of the cropped original images used as a reference, please click <a href="original_images.html" target="_blank">here</a></p>

        <div id="qrcode-div-background-id">
            <div id="qrcode-div-id">
                <span id="currentDateId"></span>
                <span class="close_qrcode_window" onclick="closeQRWindow()">&times;</span>
                <h1 id="qrTitleId">Elsilia's Kitchen Order</h1>
                <div id="qrcode"></div>
                <p id="qrTextId">Please Save and Send this QR Code to <strong>Elsa</strong> to confirm your order and set up an order
                    date</p>
                <p id="p_for_saved_message" style="display:none"></p>
                <button id="save-qr-button" onclick="generatePdf()">Save QR Code</button>
            </div>
        </div>

        <script>
            function generatePdf() {
                const doc = new jspdf.jsPDF();

                const imgWidth = 80;  //desired width in PDF
                const imgHeight = 80; //desired height in PDF

                //page dimensions
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();

                //center position
                const x = (pageWidth - imgWidth) / 2;
                const y = (pageHeight - imgHeight) / 2;

                
                //Browser with show (to devs) a 'deprecated feature used' warning for XMLHttpRequest when addImage is called.
                //I believe this happens due to a jspdf library call for loading the image file synchronously. It's fine- it all still works 

                //adds decorative images, sets date, logo, and QR code        
                doc.addImage("par.png", "PNG", pageWidth * 0.04, pageHeight * 0.02, 50, 75);
                doc.addImage("pep.png", "PNG", pageWidth * 0.7, pageHeight * 0.26, 40, 40);
                doc.addImage("onion.png", "PNG", pageWidth * 0.06, pageHeight * 0.46, 50, 50);
                doc.addImage("plan.png", "PNG", pageWidth * 0.503, pageHeight * 0.7, 100, 100);

                doc.setFontSize(16);
                doc.setFont("times", "normal");
                doc.text(document.getElementById('currentDateId').textContent, 5, 8);

                doc.addImage("logo_for_pdf.png", "PNG", pageWidth - 42, 0, 36, 26.7);
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text("ELSILIA'S KITCHEN", pageWidth - 23.5, 26, { align: "center" });

                let canvas = document.getElementById('qrcode').querySelector("canvas");

                // Create an <img> element with it
                let qr_img = new Image();
                qr_img.src = canvas.toDataURL("image/png");

                doc.addImage(qr_img, "PNG", x, y-20, imgWidth, imgHeight);

                doc.setFillColor(0,0,0); //black
                doc.setFillColor(255, 255, 255); //white
                // doc.setFillColor(210, 90, 33); //orange
               
                const radius = 12;

                doc.circle(pageWidth / 2 - 0.1, pageHeight /2 - 20.3, radius, 'F'); // 'F' = fill only

                doc.addImage("logo_for_pdf.png", 'PNG', pageWidth / 2 - 11.5, pageHeight / 2 - 27.5, 22.5, 15);
          
                doc.setFont("times", "bold");
                doc.setFontSize(36);

                if (document.getElementById('ball_id').classList.contains('changeToSpanish')) {
                    //SPANISH              
                    doc.text("Orden de Elsilia's Kitchen", pageWidth / 2, y - 40, { align: "center" });

                    if(savedMessage == undefined){
                        doc.setFontSize(24);
                        doc.text("¡Gracias por elegirnos!", pageWidth / 2, y + imgHeight + 10, { align: "center" });
                    }
                    else{
                        doc.setFontSize(12);
                        doc.setFont("times", "italic");
                        const wrappedText = doc.splitTextToSize(savedMessage, pageWidth - 100);
                        doc.text("Notas:", pageWidth / 2, y + imgHeight - 4, { align: "center" });
                        doc.text(wrappedText, pageWidth / 2, y + imgHeight + 4, { align: "center" });
                    }

                    doc.setFontSize(16);
                    doc.setFont("times", "normal");

                    doc.text("Por favor guarde y envíe esta página a Elsa para obtener", pageWidth / 2, y + imgHeight + 34, { align: "center" });
                    doc.text("la confirmación de su pedido y establecer una fecha de pedido.", pageWidth / 2, y + imgHeight + 40, { align: "center" });

                    doc.setFont("times", "bolditalic");
                    doc.text("Esta página por sí sola no con", (pageWidth / 2) - 26, y + imgHeight + 70, { align: "center" });

                    doc.setTextColor(255, 255, 255);
                    doc.text("firma ningún pedido.", (pageWidth / 2) + 34, y + imgHeight + 70, { align: "center" });

                    doc.save("Orden de Elsilia Kitchen - " + document.getElementById('currentDateId').textContent + ".pdf");
                }
                else{
                    //ENGLISH
                    doc.text("Elsilia's Kitchen Order", pageWidth / 2, y - 40, { align: "center" });

                    if(savedMessage == undefined){
                        doc.setFontSize(24);
                        doc.text("Thank you for choosing us!", pageWidth / 2, y + imgHeight + 10, { align: "center" });
                    }
                    else{
                        doc.setFontSize(12);
                        doc.setFont("times", "italic");
                        const wrappedText = doc.splitTextToSize(savedMessage, pageWidth - 100);
                        doc.text("Notes:", pageWidth / 2, y + imgHeight - 4, { align: "center" });
                        doc.text(wrappedText, pageWidth / 2, y + imgHeight + 4, { align: "center" });
                    }

                    doc.setFontSize(16);
                    doc.setFont("times", "normal");

                    doc.text("Please save and send this page to Elsa to get", pageWidth / 2, y + imgHeight + 34, { align: "center" });
                    doc.text("confirmation on your order and set up an order date.", pageWidth / 2, y + imgHeight + 40, { align: "center" });

                    doc.setFont("times", "bolditalic");
                    doc.text("This page alone is not a confi", (pageWidth / 2) - 25, y + imgHeight + 70, { align: "center" });

                    doc.setTextColor(255, 255, 255);
                    doc.text("rmation of any order.", (pageWidth / 2) + 34.5, y + imgHeight + 70, { align: "center" });

                    doc.save("Elsilia Kitchen Order - " + document.getElementById('currentDateId').textContent + ".pdf");
                }

            }
        </script>

    </div>


    <div class="footer">
        <!-- <h1>123</h1> -->
    </div>

    <script>

        let savedMessage = undefined;

        function openAddMessage(option){

            //cancel
            if(option == 0) {
                document.getElementById("saveContainerId").classList.toggle("show");
            }
            //save
            else if(option == 1) {
                if(document.getElementById("textareaId").value.length > 0)
                    savedMessage = document.getElementById("textareaId").value;
                else
                    savedMessage = undefined;
                document.getElementById("saveContainerId").classList.toggle("show");
            }
            //add message clicked
            else {//option == 2
                if(savedMessage != undefined){
                   document.getElementById("textareaId").value = savedMessage;
                }
                document.getElementById("saveContainerId").classList.toggle("show");
            }
        
        }

        function saveAddedMessage(){

            const message = document.getElementById("textareaId").value;

            if(message.length > 0){
                savedMessage = message;
                document.getElementById("add_message").style.color="#4091ee";
            }
            else{
                savedMessage = undefined;
                document.getElementById("add_message").style.color="black";
            }
            openAddMessage(1);
        }

        const countLabel = document.getElementById("textareaId");
        countLabel.addEventListener('input', function(event) {
            
            if(event.target.textLength == 0)
                savedMessage = undefined;

            if(event.target.textLength > 200) 
                event.target.value = event.target.value.substring(0, 200);

            document.getElementById("labelId").textContent=`${event.target.textLength}/200`;
        });

    </script>

</body>

</html>
